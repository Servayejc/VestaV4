<!DOCTYPE html><html>  <meta charset="UTF-8"> <style>	html{		width:100%;		height:100%;		font-family: Arial, Helvetica, sans-serif;		font-size: 12px;	}		body{		width:100%;		height:100%;	}		div.zoom {		width: 425px;		position: static;		//border: 1px solid blue;		transform-origin: 0% 0%;		transform: scale(1.5);		}		    .fa.fafire{		letter-spacing: -1px;		font-size:16px;		color:red;	}		.fa {		letter-spacing: -1px;		font-size:12px;	}		.fa-fire{		color:red;	}		.fa-minus{		color:green;	}		.tabulator{	    width:412px;	}	.refresh{	    font-size:8px;		color:blue;	}		.ete{	    font-size:8px;	}		p.save{	    visibility:hidden;	} 			.modal-header, h4, .close {		background-color: #5cb85c;		color:white !important;		text-align: center;		font-size: 30px;	}  	.modal-footer {		background-color: #f9f9f9;	}	</style><head>    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">	<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.5.3/css/tabulator.min.css" rel="stylesheet">	<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.0.0/css/tabulator.min.css" rel="stylesheet">		<script src="https://code.jquery.com/jquery-2.2.4.js"integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="crossorigin="anonymous"></script>	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script> 		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.4.0/js/tabulator.min.js"> </script>		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script></head><script>	tabledata= [];	//tabledata= [{"N":0, "C":1, "P":0, "DSC":"Salon", "A":"2823BF390A000060"},{"N":1,"C":2,"P":0,"DSC":"Sous-sol","A":"28BC034D030000B3"},{"N":2,"C":0,"P":0,"DSC":"Exterieur","A":"28FF9FC3C017024C"},{"N":3,"C":3,"P":0,"DSC":"Foyer","A":"2827BE54030000F2"},{"N":4,"C":4,"P":0,"DSC":"Chambre 3","A":"285FCA54030000B9"},{"N":5,"C":5,"P":0,"DSC":"SDB Haut","A":"2844CA540300001A"},{"N":6,"C":6,"P":1,"DSC":"Piscine","A":"2823BF390A000060"}];	var table; 	var Edited = false;	var canclose = false;		window.onload=function(){		showData();			LoadData();	}	window.addEventListener('beforeunload', function(e) {	    if (Edited) e.returnValue = '';	});		function Cancel(){	  alert('Cancel ?');	  // reload data from server	  LoadData();	}	function addRow(){	   tabledata = $("#tb").tabulator("getData"); 	   //alert(JSON.stringify(tabledata));	   tabledata.push({"N":tabledata.length,"C":"","P":"","DSC":"New","A":""});	   //alert(JSON.stringify(tabledata));	   $("#tb").tabulator("setData", tabledata); 	   $("#save").attr('disabled', false);	   $("#cancel").attr('disabled', false);	   $("#remove").attr('disabled', tabledata.length==0);		   Edited = true;	   	}		function removeRow(){		tabledata = $("#tb").tabulator("getData"); 		var SelectedRows = $("#tb").tabulator("getSelectedRows");		Pos = SelectedRows[0].getPosition();		//alert('Deleting ' + Pos + ' ?');		tabledata.splice(Pos, 1);		//alert(JSON.stringify(tabledata));			$("#tb").tabulator("setData", tabledata);		$("#save").attr('disabled', false);		$("#cancel").attr('disabled', false);		$("#remove").attr('disabled', tabledata.length==0);		   Edited = true;	}	function splitEvery(str, n){		var result = '';		for (var i = 0; i < str.length; i += n)			{				result = result + ' '+(str.substr(i, n));			}		return result;	}	function showData(){		$("#tb").tabulator({		//table = new Tabulator("#tb", {				fitColumns:true,			reactiveData:true, //enable reactive data			data:tabledata,			selectable:1,			columns:[{title: "#", field: "N", width: 20, headerSort:false},						{title: "C", field: "C", editor:"input", width: 20, headerSort:false, editable:true},						{title: "P", field: "P", editor:"input", width: 20, headerSort:false},						{title: "Desc", field: "DSC", editor:"input", width: 80, headerSort:false},						{title: "Address", field: "A", editor:"input", width: 210, headerSort:false, formatter:function(cell, formatterParams, onRendered){								return "<span style='font-family: monospace'>" + splitEvery(cell.getValue(),2) + "</span>"; //return the contents of the cell;							},						},					],					 cellEdited:function(cell){						document.getElementById("save").style.visibility='visible';						Edited=true;						refresh=false;						$("#save").attr('disabled', false);						$("#cancel").attr('disabled', false);						clearInterval(T);						document.getElementsByClassName("refresh")[0].innerHTML = "Rafraîchir"; 					},		});		tabledata = $("#tb").tabulator	}	function LoadData(){		var x = window.location.href;		var y = x.substr(0, x.lastIndexOf('/'));		url = y + '/getsensors';		//alert('load data');   	    Edited = false;		$("#save").attr('disabled', true);		$("#cancel").attr('disabled', true);		$("#tb").tabulator("setData",tabledata);		$("#tb").tabulator("redraw",true);		fetch(url)		.then (function(resp){			if (!resp.ok) {				Alert ("Respone NOT ok");				throw Error(resp.statusText);			}			return resp.json().then(function(json){			if (json){ 			    //alert(json.Sensors); 				$("#tb").tabulator("setData", json.Sensors);				$("#tb").tabulator("redraw",true);											}			});			})		.catch(function(error) {		});	}		function SaveData(){		$("#save").attr('disabled', true);		$("#cancel").attr('disabled', true);		//document.getElementById("save").style.visibility='hidden';		tabledata = $("#tb").tabulator("getData"); 		payload = '{"Sensors":';		payload += JSON.stringify(tabledata);		payload += '}';		var x = window.location.href;		var y = x.substr(0, x.lastIndexOf('/'));		url = y + '/savesensors?data=';		url += payload;		fetch(url)		.then (function(resp){			if (!resp.ok) {				alert ("Respone NOT ok");				throw Error(resp.statusText);			}			return resp.text()			.then(function(text) {				if (text){					alert(text);					Edited = false;				}			});			})		.catch(function(error) {			alert(error);				});				}		</script><body>	<div class = "zoom">		<H2> Sondes de température</H2>		<div id="tb"></div>		<button type="button" id="add"    class="btn btn-primary btn-sm"  onclick="addRow()">    Add row    </button>  		<button type="button" id="remove" class="btn btn-primary btn-sm"  onclick="removeRow()"> Remove row </button>		<button type="button" id="save"   class="btn btn-primary btn-sm" disabled="disabled" onclick="SaveData()">  Save       </button>		<button type="button" id="cancel" class="btn btn-primary btn-sm" disabled="disabled" onclick="LoadData()">  Cancel     </button	</div>		 <!-- The Modal --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" >  <div class="modal-dialog" role="document">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>      </div>      <div class="modal-body">        <p>One fine body&hellip;</p>      </div>      <div class="modal-footer">        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="Save()">Save</button>        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="Cancel()">Cancel</button>      </div>    </div><!-- /.modal-content -->  </div><!-- /.modal-dialog --></div><!-- /.modal -->    </body></html>